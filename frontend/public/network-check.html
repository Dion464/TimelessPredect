<!DOCTYPE html>
<html>
<head>
    <title>Network Check</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
</head>
<body>
    <h1>MetaMask Network Check</h1>
    <button id="checkBtn">Check Network & Connection</button>
    <div id="results"></div>

    <script>
        document.getElementById('checkBtn').addEventListener('click', async () => {
            try {
                if (typeof window.ethereum === 'undefined') {
                    document.getElementById('results').innerHTML = `<p>❌ MetaMask not found</p>`;
                    return;
                }

                // Request connection
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const network = await provider.getNetwork();
                const accounts = await provider.listAccounts();
                
                document.getElementById('results').innerHTML = `
                    <h3>Network Information:</h3>
                    <p><strong>Chain ID:</strong> ${network.chainId}</p>
                    <p><strong>Network Name:</strong> ${network.name}</p>
                    <p><strong>Connected Account:</strong> ${accounts[0]}</p>
                    <p><strong>Expected Chain ID:</strong> 1337 (Hardhat Local)</p>
                    <p><strong>Status:</strong> ${network.chainId === 1337 ? '✅ Correct Network' : '❌ Wrong Network'}</p>
                `;
                
                // Check if we can make a simple call
                try {
                    const balance = await provider.getBalance(accounts[0]);
                    document.getElementById('results').innerHTML += `
                        <p><strong>ETH Balance:</strong> ${ethers.utils.formatEther(balance)} ETH</p>
                        <p><strong>Balance Status:</strong> ${balance.gt(0) ? '✅ Has ETH' : '❌ No ETH'}</p>
                    `;
                } catch (error) {
                    document.getElementById('results').innerHTML += `<p>❌ Error getting balance: ${error.message}</p>`;
                }
                
                // Test a simple transaction
                try {
                    const signer = provider.getSigner();
                    const tx = await signer.sendTransaction({
                        to: accounts[0], // Send to self
                        value: ethers.utils.parseEther("0"),
                        gasLimit: 21000
                    });
                    document.getElementById('results').innerHTML += `<p>✅ Test transaction successful: ${tx.hash}</p>`;
                } catch (error) {
                    document.getElementById('results').innerHTML += `<p>❌ Test transaction failed: ${error.message}</p>`;
                }
                
            } catch (error) {
                document.getElementById('results').innerHTML = `<p>❌ Error: ${error.message}</p>`;
            }
        });
    </script>
</body>
</html>
