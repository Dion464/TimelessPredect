<!DOCTYPE html>
<html>
<head>
    <title>Debug Contract Connection</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #333; }
        .button {
            background: #007bff;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        .button:hover { background: #0056b3; }
        .info { color: #666; margin: 20px 0; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 5px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔧 Debug Contract Connection</h1>
        <div class="info">
            <p>This page tests the contract connection and market data retrieval.</p>
        </div>
        
        <button class="button" onclick="testContractConnection()">🔗 Test Contract Connection</button>
        <button class="button" onclick="testMarketData()">📊 Test Market Data</button>
        
        <div id="results"></div>
    </div>

    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script>
        const CONTRACT_ADDRESS = "0x1fA02b2d6A771842690194Cf62D91bdd92BfE28d";
        const CONTRACT_ABI = [
            "function getActiveMarkets() external view returns (uint256[] memory)",
            "function getMarket(uint256 _marketId) external view returns (tuple(uint256 id, string question, string description, string category, uint256 endTime, uint256 resolutionTime, bool resolved, uint8 outcome, uint256 totalYesShares, uint256 totalNoShares, uint256 totalVolume, address creator, uint256 createdAt, bool active))",
            "function pricingAMM() external view returns (address)"
        ];

        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.textContent = message;
            results.appendChild(logDiv);
            console.log(message);
        }

        async function testContractConnection() {
            log('🔍 Testing contract connection...');
            
            if (typeof window.ethereum === 'undefined') {
                log('❌ MetaMask not detected!', 'error');
                return;
            }
            
            try {
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const signer = provider.getSigner();
                const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                
                log(`✅ Contract connected to: ${CONTRACT_ADDRESS}`, 'success');
                
                // Test getActiveMarkets
                const activeMarkets = await contract.getActiveMarkets();
                log(`✅ Active markets count: ${activeMarkets.length}`, 'success');
                log(`✅ Active market IDs: [${activeMarkets.join(', ')}]`, 'success');
                
                if (activeMarkets.length > 0) {
                    // Test getMarket
                    const market = await contract.getMarket(1);
                    log(`✅ Market 1: ${market.question}`, 'success');
                    
                    // Test pricingAMM
                    const pricingAMMAddress = await contract.pricingAMM();
                    log(`✅ PricingAMM address: ${pricingAMMAddress}`, 'success');
                }
                
            } catch (error) {
                log(`❌ Contract connection error: ${error.message}`, 'error');
            }
        }

        async function testMarketData() {
            log('📊 Testing market data retrieval...');
            
            try {
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                const signer = provider.getSigner();
                const contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                
                const activeMarkets = await contract.getActiveMarkets();
                
                if (activeMarkets.length > 0) {
                    const market = await contract.getMarket(activeMarkets[0]);
                    log(`✅ First market: ${market.question}`, 'success');
                    log(`✅ Category: ${market.category}`, 'success');
                    log(`✅ Active: ${market.active}`, 'success');
                } else {
                    log('⚠️ No active markets found', 'error');
                }
                
            } catch (error) {
                log(`❌ Market data error: ${error.message}`, 'error');
            }
        }

        // Auto-run connection test on load
        window.addEventListener('load', () => {
            setTimeout(testContractConnection, 1000);
        });
    </script>
</body>
</html>

